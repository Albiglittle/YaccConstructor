// CodeGenerator.fs
//
// Copyright 2009 Semen Grigorev
//
// This program is free software; you can redistribute it and/or
// modify it under the terms of the GNU General Public License
// as published by the Free Software Foundation.

#light

module CodeGenerator

open IO
open IL.Production

let (out:(System.IO.StreamWriter) ref) = ref null

let print_header file_name =     
    (!out).WriteLine("//This file generated by RAPG\n\n#light\n\nmodule "+ file_name);

let print_str (str:string) = (!out).Write(str)
    
let print_import import_name = (!out).WriteLine("open "+import_name)

let print_imports imports = List.iter print_import imports

let print_int (i:int) = (!out).Write(i) 

let print_source (str,(i1,i2)) = 
    print_str("(\""+str+"\",(");
    print_int i1;
    print_str",";
    print_int i2;
    print_str"))"

let print_production production = 
    match production with 
    | PLiteral(t) -> print_str "PLiteral";print_source t   

let generate_list list_name list_body iterator = 
    (!out).WriteLine("let " + list_name + " = [" + String.concat " ; " (iterator list_body) + "]")