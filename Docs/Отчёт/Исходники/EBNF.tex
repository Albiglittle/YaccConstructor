\subsection{Расширенные контекстно свободные грамматики.}

На практике оказывается удобно пользоваться расширенной контекстно свободной или EBNF грамматикой.
То-есть такой грамматикой, у которой в правых частях правил могут использоваться конструкции регулярных выражений. Необходимость использования EBNF в инструментах генерации анализаторов обоснована в работе \cite{Diploma}.


В качестве примера рассмотрим грамматику арифмитических выражений без приоритетов :

\hspace{0,9cm} 1) $E \rightarrow E $'$+$'$ E$

\hspace{0,9cm} 2) $E \rightarrow E $'$*$'$ E$

\hspace{0,9cm} 3) $E \rightarrow $'$($'$E$'$)$'

\hspace{0,9cm} 4) $E \rightarrow $'$a$' 

В данном случае удобно объединить правила 1) и 2) в одно:

\hspace{0,9cm} $E \rightarrow E ($'$+$' | '$*$'$) E$
 
  Далее:
  
\hspace{0,9cm} $E \rightarrow (E ($'$+$' | '$*$'$) E) | ($ '$($'$E$'$)$' $) | $'$a$'                                      (1).

Для того, чтобы построить табличный LR анализатор необходимо преобразовать расширенную  контекстно свободную грамматику. Нужно избавиться от конструкции BNF в правых частях.  Однако можно попробовать обойтись без преобразований грамматики.

Существуют способы поддержки расширенной контекстно свободной грамматики на уровне анализатора, без преобразований входной грамматики \cite{Non-det-rec-asc}. Для этого нужно переопределить функцию goto. Можно заменить позицию точки в правиле на номер состояния конечного автомата, построенного по соответствующему регулярному выражению. Заметим, что определённая выше функция goto может быть описана в терминах конечного автомата. В этом случае регулярное выражение и ,следовательно ,построенный по нему автомат очень прост.  

Для построения конечного автомата по регулярному выражению воспользуемся алгоритмом Томпсона\cite{DrgBook}. Результатом работы данного алгоритма является недетерминированный конечный автомат (НКА). Так как правая часть правила (1) - регулярное выражение, то применим к ней алгоритм Томпсона. Получим следующий НКА: **здесь должен быть граф**

Каждое состояние и каждый переход КА должны преобразоваться в состояние и переход LR автомата соответственно. Заметим, что в в полученном НКА много $\varepsilon$-переходов. Например, каждая альтернатива вносит два дополнительных состояния и 4 $\varepsilon$-перехода. Чтобы уменьшить количество переходов в результирующем LR-автомате можно преобразовать НКА в детерминированный конечный автомат(ДКА). Для этого применим стандартный алгоритм преобразования НКА в ДКА\cite{DrgBook}. Полученный в результате преобразований ДКА будет выглядеть следующим образом:**здесь должен быть граф**

Перейдём к построению LR ситуаций. Как было сказано выше, основная идея состоит в том, что точку из классического определения ситуации нужно заменить состоянием, получившегося на предыдущем шаге, ДКА. Поясним. Предположим, что правило грамматики не содержит конструкций BNF. Например:

\hspace{0,9cm} $E \rightarrow E $'$+$'$ E$

Множество ситуаций для данного правила:

\hspace{0,9cm} 1) $E \rightarrow .E $'$+$'$ E$

\hspace{0,9cm} 2) $E \rightarrow E $'$.+$'$ E$

\hspace{0,9cm} 3) $E \rightarrow E $'$+$'$ .E$

\hspace{0,9cm} 4) $E \rightarrow E $'$+$'$ E.$

Теперь построим ДКА в соответствии с нашим алгоритмом. Результат показан на рисунке ниже.

\begin{figure}[h]
	\centering
		\includegraphics[width=8cm,height=1.5cm]{Simple.jpeg}
	\label{fig:Simple}
	\caption{}
\end{figure}

У построенного ДКА четыре состояния: $S_{1}$ , $S_{2}$ , $S_{3}$ , $S_{4}$. Сопоставим состоянию $S_{1}$ ситуацию $E \rightarrow .E $'$+$'$ E$, S2 ситуацию $E \rightarrow E $'$.+$'$ E$ и так далее. В итоге получим соответствие: 

\hspace{0,9cm} $S_{1}$ - $E \rightarrow .E $'$+$'$ E$

\hspace{0,9cm} $S_{2}$ - $E \rightarrow E .$'$+$'$ E$

\hspace{0,9cm} $S_{3}$ - $E \rightarrow E $'$+$'$ .E$

\hspace{0,9cm} $S_{4}$ - $E \rightarrow E $'$+$'$ E.$

Таким образом, киждой LR-ситуации мы смогли сопоставить состояние ДКА, построенного по правой части правила. Заметим, что ситуация характеризуется правилом, для которого она строится и положением точки в правой части этого правила. Теперь вернёмся к предыдущему примеру и обобщим ситуацию. 

Предположим, что в правой части правила - произвольное регулярное выражение. Выше мы построили по нему ДКА. Теперь построим для каждого состояния ДКА LR-ситуацию. 

Для этого сперва построим структуру данных, в которой будем сохранять одну ситуацию. Для дальнейшей работы нужна следующая информация:

\begin{itemize}
\item Информация о правиле. Для этого занумеруем все правила и будем хранить номер правила. Кроме этого 
\item Состояние ДКА.  
\end{itemize}


Множество состояний ДКА: 
