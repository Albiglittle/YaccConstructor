\section{Реализация}

\subsection{Механизм анализа}

В качестве алгоритма анализа выбран рекурсивно-восходящий алгоритм. Основан на наборе взаимно-рекурсивных функций. Удобно реализуется на ФЯ.	

\subsection{Алгоритм анализа. Основные функции}

\subsection{Построение леса вывода}

\subsection{Вычисление атрибутов}

YARD позволяет определять атрибуты для любой части продукции, которая является последовательностью.

Необходимо знать

Дерево вывода выглядит так:

Сыновья одного уровня задают строку, выводимую в грамматике, заданной регулярным выражением в правой части правила. По этому при вычислении атрибутов


TNFA определяется как пятёрка $(Q$, $\Sigma$, $L$, $T$, $q_0$, $F)$, состоящая из:
\begin{itemize}
	\item конечного множества состояний $Q$ 
	\item конечного множества входных символов $\Sigma$ 
	\item конечного множества меток $L$ 
	\item функции перехода $T:$ $Q \times (Z \cup{ \epsilon })\rightarrow 2^{Q \times L}$
	\item начального состояния $q_0$
	\item конечного множества финальных состояний $F$ 
\end{itemize}

Таким образом переходы автомата снабжаются метками. При изображении автомата в виде графа, переходам соответствуют рёбра. Будем записывать метки через знак "/" \; после символа, принимаемого автоматом при данном переходе. 

Пример THFA:

%\includepdf[height = 3cm, width = 3cm]{TNFA_SAMPLE.pdf}
\begin{dot2tex}[dot]
digraph G
{
        rankdir = LR
        S -> F [label="a/l"]
}
\end{dot2tex}


Здесь a -- принимаемый символ, l -- метка.

Чтобы решить задачу необходимо знать, когда началось и когда закончилось распознавание той или иной конструкции регулярного выражения. Для этого определим  метки специального типа:
\begin{itemize}
	\item для обозначения начала и конца конструкции
		\begin{itemize}
			\item лист: $EltS,$ $EltE$;
			\item последовательность: $SeqS,$ $SeqE$;
			\item замыкание: $ClsS,$ $ClsE$;
			\item альтернатива: $Alt1S,$ $Alt1E,$ $Alt2S,$ $Alt2E$ - пара меток для каждой ветви;
		\end{itemize}
			\item $\omega$ -- "`пустая"' метка;
\end{itemize}

Метка для конкретного ребра будет состоять из типа метки и уникального идентификатора, который совпадает у меток начала и конца одной и той же конструкции. Таким образом, множество меток $L$ можно определить так:

\begin{eqnarray*}
	  L = \left\{ \right. t*i\; | \; t \in \left\{ \right. & SeqS,\; SeqE,\; EltS,\; EltE,\; ClsS,\; ClsE, & \\
	                                                       & Alt1S,\; Alt1E,\; Alt2S,\; Alt2E,\; \omega \; \left. \right\},\; i \in N \left.\right\} &
\end{eqnarray*}



Для построения TNFA по регулярному выражению необходимо модернизировать алгоритм Томпсона. Его необходимо дополнить механизмом расстановки меток.

Модернизированный алгоритм будет выглядеть следующим образом:



Для дальнейшего использования нам нужен детерминированный автомат. При этом метки должны сохраниться

\subsubsection{Построение трассы}




\subsubsection{Генерация action-кода}



\subsubsection{}

\subsection{Архитектура}
\input{../sources_new/architecture.tex}
