digraph general_structure
{
	SOURCE_GRAMMAR [shape = plaintext, label = "Файл с грамматикой."]
	
	LEXEMES_SREAM [shape = plaintext, label = "Поток лексем \n Токенизированое входное выражение"]
	
	RESULT [shape = plaintext, label = "Результат \n Результат вычислений, заданных пользователем в атрибутах"]
	
	subgraph cluster_TOOL
	{
	  
	   
	   YARD [shape = box, label = "YARD \n Используется как парсер входной грамматики"]
	   
	   IL [shape = plaintext, label = "Дерево вывода грамматики"]	   	  
	   
	   TABLES [shape = plaintext, label = "Набор таблиц \n Содержит данные, необходимые для \n синтаксического анализа и вычисления атрибутов"]
	   
	   T_GOTO [shape = plaintext, label = "GOTO \n Таблица переходов \n синтаксического анализатора"]
	   T_ITEMS [shape = plaintext, label = "Items \n Информация о состояниях \n синтаксического анализатора"]
	   T_ACTION_MAP [shape = plaintext, label = "Action Map \n Отображение из првил в функции, \n сгенерированные по атрибутам этого правила"]
	   
	   SOURCE_CODE [shape = plaintext, label = "Файл на F#, содержащий функции \n для вычисления пользовательских атрибутов"]        	  
	   
	   {rank = "same"; TABLES SOURCE_CODE };
	   {rank = "same"; T_GOTO T_ITEMS T_ACTION_MAP};
	   
	   subgraph cluster_GENERATOR
	   {   	
			labeljust=l
			label = "Генератор \l По дереву грамматики строит набор таблиц \l и генерирует функции для вычисления \l пользовательских атрибутов"
			
			
			TRANSFORMATIONS[shape = box, label = "Преобразования грамматики. \n Необходимы, так как YARD поддерживает конструкции, не поддерживаемые генератором. \n Например макроправила"]
			
			TRANSFORMED_GRAMMAR[shape = plaintext, label = "Преобразованное дерево"]
			
			GENERATOR[shape = box, label = "Генерация таблиц и кода"]
			
			TRANSFORMATIONS -> TRANSFORMED_GRAMMAR
			TRANSFORMED_GRAMMAR -> GENERATOR
	   }
	   
	   
	   subgraph cluster_CORE
	   {
			label = "Ядро"
			labeljust=l
			
			TABLE_INTERPRETATOR [shape = box, label = "Интерпретатор таблиц \n Строит лес вывода входного выражения \n на основе сгенерированных таблиц. \n Основан на рекурсивно-восходящем алгоритме"]			
			
			DIRIV_FOREST [shape = plaintext, label = "Лес вывода входного выражения"]
			
			/*subgraph cluster_AST_INTERPRETATOR
			{
				label = "Интерпертатор леса вывода \n Вычисляет атрибуты над лесом вывода"
				TREE_WALKER[shape = box, label ="Обход дерева вывода"]
				NODES[shape = plaintext, label = "Список сыновей узла дерева вывода"]
				STRING_TO_TREE_CONVERTER[shape = box, label ="Свёртка списка в дерево"]
				RE_TREE[shape = plaintext, label = "Дерево вывода строки в грамматике, \n заданной регулярным выражением \n в правой части правила"]
				CALCULATOR[shape = box, label ="Вычисление \n Применнение функции, найденной \n с помощью Action Map в \n сгенерённом файле, к дереву"]
				
				TREE_WALKER -> NODES
				NODES -> STRING_TO_TREE_CONVERTER
				STRING_TO_TREE_CONVERTER -> RE_TREE
				RE_TREE -> CALCULATOR
				
			}
			*/
			
			CALCULATOR[shape = box, label ="Вычисление \n Применнение функции, найденной \n с помощью Action Map в \n сгенерённом файле, к дереву"]
			
			TABLE_INTERPRETATOR -> DIRIV_FOREST		
			//DIRIV_FOREST -> TREE_WALKER
			DIRIV_FOREST -> CALCULATOR
	   }
	   	   
	   YARD -> IL
	   IL -> TRANSFORMATIONS      
	   GENERATOR -> TABLES
	   GENERATOR -> SOURCE_CODE   	   
	   TABLES -> T_GOTO
	   TABLES -> T_ITEMS
	   TABLES -> T_ACTION_MAP
	   T_GOTO -> TABLE_INTERPRETATOR
	   T_ITEMS -> TABLE_INTERPRETATOR   
	   SOURCE_CODE -> CALCULATOR
	   T_ACTION_MAP -> CALCULATOR	   
   }
   
   SOURCE_GRAMMAR -> YARD
   LEXEMES_SREAM -> TABLE_INTERPRETATOR
   CALCULATOR -> RESULT
}